<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>購物車</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
		<h2 class="text-center mb-4">購物車</h2>
		
		<table class="table table-bordered text-center align-middle">
			<thead class="table-dark">
				<tr>
					<th>圖片</th>
					<th>名稱</th>
					<th>單價</th>
					<th>數量</th>
					<th>小計</th>
					<th>操作</th>				
				</tr>			
			</thead>
			<tbody id="cartBody">
			
			</tbody>
		</table>
		<p>總金額:<span id="totalAmountDisplay">0</span></p>
		<form id="checkoutForm" method="post" action="/checkout/ecpay">
			<input type="hidden" name="totalAmount" id="totalAmountInput" />
			<input type="text" name="phone" placeholder="請輸入手機號碼" required />
			<button type="submit" class="btn btn-success">付款</button>
		</form>
		
		<script>
			function renderCart(){
				const cart = JSON.parse(localStorage.getItem("cart")) || [];
				const cartBody = document.getElementById("cartBody");
				const totalAmountDisplay = document.getElementById("totalAmountDisplay");
				const totalAmountInput = document.getElementById("totalAmountInput");
				cartBody.innerHTML = "";
				let total = 0;
				
				cart.forEach((item, index) => {
					const subtotal = item.unitPrice * item.quantity;
					total += subtotal;
					
					const row = document.createElement("tr");
					row.innerHTML = `
					<td><img src="${item.imageUrl}" width="80"></td>
					<td>${item.menuName}</td>
					<td>$${item.unitPrice}</td>
					<td>${item.quantity}</td>
					<td>$${subtotal}</td>
					<td><button class="btn btn-sm btn-danger" onclick="removeItem(${index})">刪除</button></td>
					`;
					cartBody.appendChild(row);
				});
				
				totalAmountDisplay.textContent = "$" + total;
				if(totalAmountInput){
					 totalAmountInput.value = total;
				  }
				}
				function removeItem(index){
				const cart = JSON.parse(localStorage.getItem("cart")) || [];
				cart.splice(index, 1);
				localStorage.setItem("cart", JSON.stringify(cart));
				renderCart();				
			}
			renderCart();
		</script>
</body>
</html>